<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Title</title>
    <script>document.write("<script type='text/javascript' src='/check_list.github.io/static/js/db.js?u=" + Date.now() + "'><\/script>");</script>
    <script>document.write("<script type='text/javascript' src='/check_list.github.io/static/js/jquery.js?u=" + Date.now() + "'><\/script>");</script>
    <script>document.write("<link rel='stylesheet' href='/check_list.github.io/static/css/style.css?u=" + Date.now() + "'>");</script>
    <script>document.write("<link rel='stylesheet' href='/check_list.github.io/static/css/check_list.css?u=" + Date.now() + "'>");</script>
    <script>document.write("<link rel='stylesheet' href='/check_list.github.io/static/css/popup.css?u=" + Date.now() + "'>");</script>
    <title>Список чек-листов</title>
</head>
<body>

<div class="container">
    <div  class="container_title"><span>Чек-листы</span></div>
    <div id="check_list_box" class="check_lists">
    </div>
    <footer id="footer_content" class="container_footer_content"><span class="container_footer_content_text">ГБУЗ НСО ССМП</span></footer>
</div>
<div id="pop-up">
  <div id="pop-box">
    <div id="pop-close" onclick="pop.close()">x</div>
      <div id="pop-up-items" class="pop_up_items"></div>
  </div>
</div>
<script>
    var pop;
    function createItems(e){
        console.log(e.getAttribute('data-param'));
          var parent_id_value =  e.getAttribute('data-param');
          var tx = db.transaction(['check_list_items'],"readwrite");
          var store = tx.objectStore('check_list_items');
          var cursor = store.openCursor();
          var list_items=[];
          cursor.onsuccess = function(e) {
                var res = e.target.result;
                if(res) {
                      if (res.value.parent_id == parent_id_value){
                          list_items.push(res.value.title);
                      }
                  res.continue();
                }else{

                    pop = {
                                  open : function (items) {
                                     $('#pop-up-items').empty();
                                    $('#pop-up-items').append(items);
                                    document.getElementById("pop-up").classList.add("open");

                                  },

                                  close : function () {
                                    document.getElementById("pop-up").classList.remove("open");
                                  }
                              };


                   var listQuestion = '';
                   list_items.forEach(function(item, idx){
                   console.log(idx);
                       listQuestion+='<div class="item_question">'+
                                         '<input class="item_question_checkbox" type="checkbox" value="" id="'+(idx+1)+'">' +
                                         '<label class="item_question_label" for="'+(idx+1)+'">'+item+'</label>'+
                                     '</div>';
                   });
                   pop.open(listQuestion);
                   console.log(listQuestion);
                }
          };


    };

</script>
<script>
     $(document).ready(function(){
          var tx = db.transaction(['check_lists'],"readwrite");
          var store = tx.objectStore('check_lists');
          var cursor = store.openCursor(null, 'prev');

          cursor.onsuccess = function(e) {
                var res = e.target.result;
                if(res) {
                    $('#check_list_box').append(
                        '<div class="check_lists_item" data-param='+res.value.id+' onclick="createItems(this)">'+
                            '<img class="check_lists_item_img" src="/check_list.github.io/static/css/images/list.png"></img>'+
                            '<span class="check_lists_item_text">'+res.value.title+'</span>'+
                        '</div>'
                    );
                   res.continue();
                }
          }

       //

      //  listItemClick.addEventListener('click',openListItems);





     });
</script>
</body>
</html>